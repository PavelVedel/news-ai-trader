@echo off
chcp 65001 >nul
echo ========================================
echo    ОБНОВЛЕНИЕ ВСЕХ ДАННЫХ ПРОЕКТА
echo ========================================
echo.

:: Проверяем, что мы в корневой папке проекта
if not exist "apps" (
    echo [ОШИБКА] Запустите скрипт из корневой папки проекта!
    echo Текущая папка: %CD%
    echo Ожидаемая структура: apps\ingest, apps\market_data
    pause
    exit /b 1
)

echo [1/4] Запуск сбора новостей...
echo ----------------------------------------
python apps\ingest\rest_news_collector.py
if %errorlevel% neq 0 (
    echo [ПРЕДУПРЕЖДЕНИЕ] Ошибка при сборе новостей (код: %errorlevel%)
) else (
    echo [OK] Новости собраны успешно
)
echo.

echo [2/4] Запуск обновления рыночных данных...
echo ----------------------------------------
python apps\market_data\update_market_data.py
if %errorlevel% neq 0 (
    echo [ПРЕДУПРЕЖДЕНИЕ] Ошибка при обновлении рыночных данных (код: %errorlevel%)
) else (
    echo [OK] Рыночные данные обновлены успешно
)
echo.

echo [3/4] Запуск обновления фундаментальных данных...
echo ----------------------------------------
python apps\market_data\update_fundamentals.py
if %errorlevel% neq 0 (
    echo [ПРЕДУПРЕЖДЕНИЕ] Ошибка при обновлении фундаментальных данных (код: %errorlevel%)
) else (
    echo [OK] Фундаментальные данные обновлены успешно
)
echo.

echo [4/4] Запуск обновления информации о компаниях...
echo ----------------------------------------
python apps\market_data\update_infos.py
if %errorlevel% neq 0 (
    echo [ПРЕДУПРЕЖДЕНИЕ] Ошибка при обновлении информации о компаниях (код: %errorlevel%)
) else (
    echo [OK] Информация о компаниях обновлена успешно
)
echo.

echo ========================================
echo         ОБНОВЛЕНИЕ ЗАВЕРШЕНО
echo ========================================
echo.
echo Все скрипты выполнены. Проверьте логи для деталей.
echo.
pause
